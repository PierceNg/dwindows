# $Id$ 

# Dynamic Windows EMX Makefile

CC = gcc
RM = rm -f
RC = rc
MAKE = make
COMPRESS = lxlite

DEFS =
LIBS =

CFLAGS = -O -g -Zomf -Zmt -D__ST_MT_ERRNO__ -I. -Wall
LDFLAGS = -Zdll -Zcrtdll
RCFLAGS = -r


COMPATOBJECTS = compat.obj dirent.obj
COMPATSOURCES = compat.c dirent.c

all: dw.dll dwcompat.dll

dirent.obj:
	$(CC) $(CFLAGS) -c os2/dirent.c

$(COMPATOBJECTS):
	$(CC) $(CFLAGS) -c $<	

dw.dll:  
	$(CC) $(CFLAGS) $(DEFS) -o dw.dll os2/dw.c $(LDFLAGS) dw.def
	emximp -o dw.lib dw.def
	cp -f dw.dll ../dll
	cp -f dw.lib ../lib
        
dwcompat.dll:  $(COMPATOBJECTS)
	$(CC) $(CFLAGS) $(DEFS) -o dwcompat.dll $(COMPATOBJECTS) $(LDFLAGS) -lsocket dwcompat.def
	emximp -o dwcompat.lib dwcompat.def
	cp -f dwcompat.dll dll
	cp -f dwcompat.lib lib

clean: 
	$(RM) $(OBJECTS) handyftp.exe handyftp.res

dw.obj: dw.c
compat.obj: compat.c
dirent.obj: os2/dirent.c

