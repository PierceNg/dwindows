# $Id$ 

# Dynamic Windows EMX Makefile

CC = gcc
RM = rm -f
RC = rc
MAKE = make
COMPRESS = lxlite

DEFS =
LIBS =

CFLAGS = -O -g -Zomf -Zmt -D__ST_MT_ERRNO__ -I. -Wall
LDFLAGS = -Zdll -Zcrtdll
RCFLAGS = -r


COMPATOBJECTS = compat.obj dirent.obj
COMPATSOURCES = compat.c dirent.c

all: dw.dll dwcompat.dll dwtest.exe

dw.dll:  os2\dw.c dw.def
	$(CC) $(CFLAGS) $(DEFS) -o dw.dll os2/dw.c $(LDFLAGS) dw.def

dw.lib: dw.def
	emximp -o dw.lib dw.def
	copy dw.dll dll
	copy dw.lib lib
        
dwcompat.dll:  $(COMPATOBJECTS) dwcompat.def
	$(CC) $(CFLAGS) $(DEFS) -o dwcompat.dll $(COMPATOBJECTS) $(LDFLAGS) -lsocket dwcompat.def

dwcompat.lib: dwcompat.def
	emximp -o dwcompat.lib dwcompat.def
	copy dwcompat.dll dll
	copy dwcompat.lib lib

dwtest.exe: dwtest.obj dw.lib dwcompat.lib
	$(CC) $(CFLAGS) -Zcrtdll -Zomf -Zmt -o dwtest.exe dwtest.obj -Llib -ldw -ldwcompat dwtest.def

clean: 
	$(RM) $(OBJECTS) dwtest.exe

dw.obj: dw.c
	$(CC) $(CFLAGS) -c $<	

compat.obj: compat.c
	$(CC) $(CFLAGS) -c $<	

dirent.obj: os2/dirent.c
	$(CC) $(CFLAGS) -c $<	

dwtest.obj: dwtest.c
	$(CC) $(CFLAGS) -c $<	

